import{a as e,w as a,o as t,x as s,B as l,b as o,e as n,g as i,f as r,k as d,u,s as c,j as v,h as g,T as p,C as y,n as k,F as f,p as h,D as m,t as x,q as b,E as w,c as T}from"./vendor-vue-wzQQ7cRN.js";import{_ as L,u as C,a as E}from"./main-CvQJh5w7.js";import{u as M}from"./drawing-store-B6nsgwlG.js";import{s as A,_ as S,S as _,a as j,b as D,c as F,d as H,i as B,e as I}from"./confirmDialog-3WH4HYjX.js";import"./apiHelpers-R-zApMdV.js";import"./vendor-utils-B8UFEocK.js";import"./toolTip-BkCKVqxH.js";import"./pendingIcon-DRRbCSIY.js";import"./timeAgo-Dsk13s62.js";const P={class:"w-full lg:min-w-[320px] lg:w-md lg:max-w-lg bg-[#FAFAFA] dark:bg-[#222321] rounded-t-lg shadow-md flex flex-col"},R={key:0},q={key:0,class:"relative"},W={key:0,class:"p-6 text-center text-gray-500"},z={key:1,class:"p-4 space-y-3"},N={key:2,class:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 z-20 pointer-events-auto"},U={key:0,class:"flex justify-center py-4"},Y=["disabled"],$={class:"dark:text-white text-black"},G={key:1,class:"flex justify-center py-2 border-t border-gray-300 dark:border-gray-600"},J={key:0,class:"px-4 py-2 text-xs mt-2"},K={class:"text-gray-500 dark:text-white"},O={key:1,class:"px-3 py-2 text-xs text-gray-500 dark:text-white"},Q=L({__name:"TaskList",setup(L){const Q=C(),V=E();M(),Q.initCacheCleanup(),V.setActive("tasks");const X=100,Z=20,ee=e(!1),ae=e([...Q.taskFields]),te=e(null),se=e(null),le=e(null),oe=e(null),ne=e(null),ie=e(0);let re=null,de=null;const ue=T(()=>Q.tasks),ce=T(()=>Q.selectedTaskId),ve=T(()=>Q.loading),ge=T(()=>Q.softLoading),pe=T(()=>Q.loadingMore),ye=T(()=>ee.value?X:Z),ke=T(()=>{const e=window.matchMedia?.("(prefers-color-scheme: dark)").matches;return e?"1px solid rgb(142, 142, 142)":"1px solid rgb(216, 216, 216)"}),fe=T(()=>"0 2px 5px rgba(0, 0, 0, 0.1)"),he={onEnter(e){e.style.height="0",e.style.overflow="hidden",requestAnimationFrame(()=>e.style.height=e.scrollHeight+"px")},onAfterEnter(e){e.style.height="auto",e.style.overflow="visible"},onLeave(e){e.style.height=e.scrollHeight+"px",e.style.overflow="hidden",requestAnimationFrame(()=>e.style.height="0")}},me={save(){le.value&&(ie.value=le.value.scrollTop)},restore(){le.value&&ie.value>0&&(le.value.scrollTop=ie.value,ie.value=0)},restoreWithDelay(e=200){!le.value||ie.value<=0||setTimeout(()=>{le.value&&(le.value.scrollTop=ie.value,ie.value=0)},e)}},xe={save(){Q.selectedTaskId&&(ne.value=Q.selectedTaskId)},async restore(){if(!ne.value)return;ue.value.some(e=>e.id===ne.value)?Q.selectTask(ne.value):ue.value.length&&Q.selectTask(ue.value[0].id),ne.value=null,await s()}};async function be(e=1,a=ye.value,t=!0){await Q.loadTasks(e,a,t)}async function we(e){await(oe.value?.openConfirm())&&await Q.deleteTask(e)}async function Te(){const{loading:e,loadingMore:a,pagination:t}=Q;e||a||!t.hasMore||await be(t.page+1,X,!1)}function Le(){re&&(re.destroy(),re=null),ee.value&&te.value&&(re=B({el:te.value,tasks:Q.tasks,store:Q,softLoading:ge,enabled:!0}))}async function Ce(){xe.save(),me.save(),ee.value=!ee.value,Q.pagination.page=1,await Q.loadTasks(1,ye.value,!0,{useSoftLoading:!0}),await xe.restore(),ee.value?(Le(),me.restoreWithDelay(200)):(await s(),me.restore())}a(ae,async e=>{Q.setTaskFields(e),await Q.loadTasks(1,ye.value,!0,{useSoftLoading:!0})});const Ee=e=>{const a=V.sections[e];return a.visible?a.showHeaderBar?{border:ke.value}:{boxShadow:fe.value}:{border:"none"}};return t(async()=>{await be(),await s(),!ce.value&&ue.value.length&&Q.selectTask(ue.value[0].id),Le(),de&&(de.destroy(),de=null),se.value&&(de=I(se.value))}),l(()=>{[re,de].forEach(e=>{e&&(e.destroy(),e=null)})}),a(ce,e=>{null!=e&&A(e)}),a(ee,async()=>{await s(),Le()}),a(ge,async e=>{e||(await s(),Le())}),(e,a)=>(o(),n(f,null,[i(S,{ref_key:"confirmDialogRef",ref:oe},null,512),r("div",P,[r("div",{ref_key:"layoutRef",ref:se,id:"sortableSectionsWrapper",class:"flex flex-col gap-2"},[i(p,{name:"slide-fade"},{default:d(()=>[u(V).sections.header.visible?(o(),n("div",{key:0,style:c(Ee("header")),class:"rounded-lg","data-layout-id":"header"},[u(V).sections.header.showHeaderBar?(o(),v(_,{key:0,title:"Header",collapsed:u(V).sections.header.open,loading:u(Q).loading,onToggle:a[0]||(a[0]=e=>u(V).toggleSection("header"))},null,8,["collapsed","loading"])):g("",!0),i(p,{name:"filters-collapse",onEnter:he.onEnter,onAfterEnter:he.onAfterEnter,onLeave:he.onLeave},{default:d(()=>[u(V).sections.header.open?(o(),n("div",R,[i(j,{context:"task",isLoadMoreMode:ee.value,statusCounts:u(Q).pagination.statusCounts,allStatusCounts:u(Q).allStatusCounts,"total-count":u(Q).pagination.total,"loaded-count":ue.value.length,onToggleShowAll:Ce},null,8,["isLoadMoreMode","statusCounts","allStatusCounts","total-count","loaded-count"])])):g("",!0)]),_:1},8,["onEnter","onAfterEnter","onLeave"])],4)):g("",!0)]),_:1}),i(p,{name:"slide-fade"},{default:d(()=>[u(V).sections.filters.visible?(o(),n("div",{key:0,style:c(Ee("filters")),class:"rounded-lg","data-layout-id":"filters"},[i(D,{open:u(V).layouts.tasks.sections.filters.open,"onUpdate:open":a[1]||(a[1]=e=>u(V).layouts.tasks.sections.filters.open=e)},null,8,["open"])],4)):g("",!0)]),_:1}),i(p,{name:"slide-fade"},{default:d(()=>[u(V).sections.tasklist.visible?(o(),n("div",{key:0,class:"rounded-t-lg",style:c(Ee("tasklist")),"data-layout-id":"tasklist"},[u(V).sections.tasklist.showHeaderBar?(o(),v(_,{key:0,title:"Tasks List - "+(ee.value?"Sort Mode":"Page Mode"),collapsed:u(V).sections.tasklist.open,activeCount:ue.value.length,loading:u(Q).loading,onToggle:a[2]||(a[2]=e=>u(V).toggleSection("tasklist"))},null,8,["title","collapsed","activeCount","loading"])):g("",!0),i(p,{name:"filters-collapse",onEnter:he.onEnter,onAfterEnter:he.onAfterEnter,onLeave:he.onLeave},{default:d(()=>[u(V).sections.tasklist.open?(o(),n("div",q,[r("div",{ref_key:"scrollContainerRef",ref:le,class:"relative overflow-y-auto",style:c({maxHeight:ee.value?"calc(80vh - 10rem)":"calc(85vh - 10rem)"})},[y(r("ul",{ref_key:"taskListRef",ref:te,id:"sortable-list",class:k(["p-0 transition-opacity duration-200",{"opacity-50 pointer-events-none select-none":u(Q).softLoading}])},[(o(!0),n(f,null,h(ue.value,e=>(o(),v(F,{key:e.id,type:"task",entity:e,"is-selected":e.id===ce.value,onDeleteTask:we,onSelectTask:u(Q).selectTask,id:`task-${e.id}`,isLoadMore:ee.value},null,8,["entity","is-selected","onSelectTask","id","isLoadMore"]))),128))],2),[[m,ue.value.length]]),ue.value.length||ve.value?g("",!0):(o(),n("div",W,[...a[4]||(a[4]=[r("p",{class:"text-sm sm:text-base"},"No tasks yet",-1)])])),ve.value&&!ge.value?(o(),n("div",z,[(o(),n(f,null,h(3,e=>r("div",{key:e,class:"flex items-center space-x-3 p-4 bg-gray-transparent dark:bg-gray-800/50 rounded-lg animate-pulse"},[...a[5]||(a[5]=[r("div",{class:"w-5 h-5 bg-gray-300 dark:bg-gray-700 rounded mr-2"},null,-1),r("div",{class:"flex-1 space-y-2"},[r("div",{class:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"}),r("div",{class:"h-3 bg-gray-200 dark:bg-gray-700/50 rounded w-1/2"})],-1)])])),64))])):g("",!0),ge.value?(o(),n("div",N,[...a[6]||(a[6]=[r("svg",{class:"w-8 h-8 animate-spin text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("circle",{cx:"12",cy:"12",r:"10","stroke-width":"4","stroke-linecap":"round",stroke:"currentColor"})],-1)])])):g("",!0)],4),ee.value&&u(Q).pagination.hasMore?(o(),n("div",U,[r("button",{class:"disabled:opacity-50 cursor-pointer",disabled:u(Q).loadingMore,onClick:Te},[r("span",$,x(u(Q).loadingMore?"Loading...":"Load More"),1)],8,Y)])):g("",!0),!ee.value&&u(Q).pagination.lastPage>1&&!pe.value?(o(),n("div",G,[i(H,{page:u(Q).pagination.page,"last-page":u(Q).pagination.lastPage,onChange:a[3]||(a[3]=e=>be(e))},null,8,["page","last-page"])])):g("",!0)])):g("",!0)]),_:1},8,["onEnter","onAfterEnter","onLeave"])],4)):g("",!0)]),_:1})],512),u(V).sections.tasklist.open?g("",!0):(o(),n("div",J,[r("span",K," You have total of "+x(u(Q).pagination.total)+" tasks - ",1),r("span",{class:k(ee.value?"text-green-500":"text-gray-500")},x(ee.value?"Sort mode":"Page mode"),3)])),ee.value?(o(),n("div",O,[a[7]||(a[7]=b(" Drag to reorder tasks Â· Changes are saved automatically. ",-1)),r("button",{onClick:w(Ce,["stop"]),class:"text-red-500 underline px-2 cursor-pointer"}," Disable! ")])):g("",!0)])],64))}},[["__scopeId","data-v-e8de489d"]]);export{Q as default};

import{d as a}from"./vendor-vue-BkEISqGT.js";import{p as t,g as s}from"./apiHelpers-DHex_rN5.js";import{c as i,a as n}from"./main-Bc4UwIiF.js";const e=n(),r=(a,t)=>`${a}-${t}`,o=a("drawing",{state:()=>({cache:{},loading:!1,saving:!1}),actions:{async loadDrawing(a,t){const n="task"===a?e.layouts?.tasks?.detailsSections?.canvas:e.layouts?.projects?.detailsSections?.canvas;if(!n?.visible)return null;const o=r(a,t);if(o in this.cache)return this.cache[o];this.loading=!0;try{const i=await function(a,t,i){return s("/api/drawings",{type:a,id:t},{signal:i})}(a,t);let n=null;return i?.data&&(n="string"==typeof i.data?i.data:i.data?.data&&"string"==typeof i.data.data?i.data.data:i.data),this.cache[o]=n}catch(c){if(404===c?.response?.status)return this.cache[o]=null;throw i().show("error","Could not load drawing."),c}finally{this.loading=!1}},async saveDrawing({type:a,id:s,data:n}){const e=r(a,s);this.saving=!0;try{const r="string"==typeof n?n:JSON.stringify(n),o=await function(a){return t("/api/drawings",a)}({type:a,id:s,data:r}),c=o?.data??r;return this.cache[e]=c,i().show("success","Drawing saved."),c}catch(o){throw i().show("error","Failed to save drawing."),o}finally{this.saving=!1}},invalidate(a,t){delete this.cache[r(a,t)]},clearAll(){this.cache={}}}});export{o as u};

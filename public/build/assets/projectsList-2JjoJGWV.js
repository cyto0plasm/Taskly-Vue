import{o as e,w as a,x as t,B as s,b as l,e as o,g as n,f as i,k as r,u as d,s as c,j as u,h as g,T as p,C as v,n as y,F as f,p as h,D as m,t as x,q as b,E as j,c as k,a as w}from"./vendor-vue-wzQQ7cRN.js";import{b as M,a as C}from"./main-CvQJh5w7.js";import{e as L,s as S,_ as P,S as _,a as A,b as H,c as T,d as D,f as F}from"./confirmDialog-3WH4HYjX.js";import"./apiHelpers-R-zApMdV.js";import"./vendor-utils-B8UFEocK.js";import"./toolTip-BkCKVqxH.js";import"./pendingIcon-DRRbCSIY.js";import"./timeAgo-Dsk13s62.js";const B={class:"w-full lg:min-w-[320px] lg:w-md lg:max-w-lg bg-[#FAFAFA] dark:bg-[#222321] rounded-t-lg shadow-md flex flex-col"},E={key:0},q={key:0,class:"relative"},R={key:0,class:"p-4 space-y-3"},I={key:1,class:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 z-20 pointer-events-auto"},z={key:2,class:"p-6 text-center text-gray-500"},N={key:0,class:"flex justify-center py-4"},U=["disabled"],W={class:"dark:text-white text-black"},Y={key:1,class:"flex justify-center py-2 border-t border-gray-300 dark:border-gray-600"},$={key:0,class:"px-4 py-2 text-xs mt-2"},G={class:"text-gray-500 dark:text-white"},J={key:1,class:"px-3 py-2 text-xs text-gray-500 dark:text-white"},K={__name:"projectsList",setup(K){const O=M(),Q=C();Q.setActive("projects");const V=w(null),X=k(()=>O.projects),Z=k(()=>O.selectedProjectId),ee=k(()=>O.loading),ae=k(()=>O.softLoading),te=k(()=>O.loadingMore),se=w(!1),le=w(null),oe=w(null);let ne=null,ie=null;function re(e){e.style.height="0",e.style.overflow="hidden",requestAnimationFrame(()=>e.style.height=e.scrollHeight+"px")}function de(e){e.style.height="auto",e.style.overflow="visible"}function ce(e){e.style.height=e.scrollHeight+"px",e.style.overflow="hidden",requestAnimationFrame(()=>e.style.height="0")}async function ue(e=1,a=(se.value?100:20),t=!0){await O.loadProjects(e,a,t)}async function ge(e){await V.value.openConfirm()&&await O.deleteProject(e)}async function pe(){O.loading||O.loadingMore||!O.pagination.hasMore||await ue(O.pagination.page+1,100,!1)}async function ve(){se.value=!se.value,O.pagination.page=1,await O.loadProjects(1,se.value?100:20,!0,{useSoftLoading:!0}),await t(),ye()}function ye(){ne&&(ne.destroy(),ne=null),se.value&&le.value&&(ne=F({el:le.value,projects:O.projects,store:O,softLoading:ae,enabled:!0}))}e(async()=>{await ue(),!Z.value&&X.value.length&&O.selectProject(X.value[0].id),ye(),ie=L(oe.value)}),a(Z,e=>{null!=e&&S(e)}),a(se,async()=>{await t(),ye()}),a(ae,async e=>{e||(await t(),ye())}),s(()=>{ne&&(ne.destroy(),ne=null),ie&&(ie.destroy(),ie=null)});const fe=k(()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"1px solid rgb(142, 142, 142)":"1px solid rgb(216 216 216)"),he=k(()=>"0 2px 5px rgba(0, 0, 0, 0.1)"),me=e=>{const a=Q.sections[e];return a.visible?a.showHeaderBar?{border:fe.value}:{boxShadow:he.value}:{border:"none"}};return(e,a)=>(l(),o(f,null,[n(P,{ref_key:"confirmDialogRef",ref:V},null,512),i("div",B,[i("div",{ref_key:"layoutRef",ref:oe,id:"sortableSectionsWrapper",class:"flex flex-col gap-2"},[n(p,{name:"slide-fade"},{default:r(()=>[d(Q).sections.header.visible?(l(),o("div",{key:0,style:c(me("header")),class:"rounded-lg","data-layout-id":"header"},[d(Q).sections.header.showHeaderBar?(l(),u(_,{key:0,title:"Header",collapsed:d(Q).sections.header.open,loading:d(O).loading,onToggle:a[0]||(a[0]=e=>d(Q).toggleSection("header"))},null,8,["collapsed","loading"])):g("",!0),n(p,{name:"filters-collapse",onEnter:re,onAfterEnter:de,onLeave:ce},{default:r(()=>[d(Q).sections.header.open?(l(),o("div",E,[n(A,{context:"project",isLoadMoreMode:se.value,statusCounts:d(O).pagination.statusCounts,allStatusCounts:d(O).allStatusCounts,"total-count":d(O).pagination.total,"loaded-count":X.value.length,onToggleShowAll:ve},null,8,["isLoadMoreMode","statusCounts","allStatusCounts","total-count","loaded-count"])])):g("",!0)]),_:1})],4)):g("",!0)]),_:1}),n(p,{name:"slide-fade"},{default:r(()=>[d(Q).sections.filters?.visible?(l(),o("div",{key:0,style:c(me("filters")),class:"rounded-t-lg","data-layout-id":"filters"},[n(H,{context:"project",open:d(Q).layouts.projects.sections.filters.open,"onUpdate:open":a[1]||(a[1]=e=>d(Q).layouts.projects.sections.filters.open=e)},null,8,["open"])],4)):g("",!0)]),_:1}),n(p,{name:"slide-fade"},{default:r(()=>[d(Q).sections.projectlist.visible?(l(),o("div",{key:0,class:"rounded-t-lg",style:c(me("projectlist")),"data-layout-id":"projectlist"},[d(Q).sections.projectlist.showHeaderBar?(l(),u(_,{key:0,title:"Projects List - "+(se.value?"Sort Mode":"Page Mode"),collapsed:d(Q).sections.projectlist.open,activeCount:X.value.length,loading:d(O).loading,onToggle:a[2]||(a[2]=e=>d(Q).toggleSection("projectlist"))},null,8,["title","collapsed","activeCount","loading"])):g("",!0),n(p,{name:"filters-collapse",onEnter:re,onAfterEnter:de,onLeave:ce},{default:r(()=>[d(Q).sections.projectlist.open?(l(),o("div",q,[i("div",{class:"relative overflow-y-auto",style:c({maxHeight:se.value?"calc(80vh - 10rem)":"calc(85vh - 10rem)"})},[v(i("ul",{ref_key:"projectListRef",ref:le,id:"sortable-list",class:y(["p-0 transition-opacity duration-200",{"opacity-50 pointer-events-none select-none":d(O).softLoading}])},[(l(!0),o(f,null,h(X.value,e=>(l(),u(T,{key:e.id,type:"project",entity:e,"is-selected":e.id===Z.value,onDeleteTask:ge,onSelectTask:d(O).selectProject,id:`project-${e.id}`,isLoadMore:se.value},null,8,["entity","is-selected","onSelectTask","id","isLoadMore"]))),128))],2),[[m,X.value.length]]),ee.value&&!ae.value?(l(),o("div",R,[(l(),o(f,null,h(3,e=>i("div",{key:e,class:"flex items-center space-x-3 p-4 bg-gray-transparent dark:bg-gray-800/50 rounded-lg animate-pulse"},[...a[4]||(a[4]=[i("div",{class:"w-5 h-5 bg-gray-300 dark:bg-gray-700 rounded mr-2"},null,-1),i("div",{class:"flex-1 space-y-2"},[i("div",{class:"h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"}),i("div",{class:"h-3 bg-gray-200 dark:bg-gray-700/50 rounded w-1/2"})],-1)])])),64))])):g("",!0),ae.value?(l(),o("div",I,[...a[5]||(a[5]=[i("svg",{class:"w-8 h-8 animate-spin text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[i("circle",{cx:"12",cy:"12",r:"10","stroke-width":"4","stroke-linecap":"round",stroke:"currentColor"})],-1)])])):!X.value||0===X.value.length||ee.value?(l(),o("ul",z,[...a[6]||(a[6]=[i("li",null,[i("p",{class:"text-sm sm:text-base"}," No projects yet ")],-1)])])):g("",!0)],4),se.value&&d(O).pagination.hasMore?(l(),o("div",N,[i("button",{class:"disabled:opacity-50",disabled:d(O).loadingMore,onClick:pe},[i("span",W,x(d(O).loadingMore?"Loading...":"Load More"),1)],8,U)])):g("",!0),!se.value&&d(O).pagination.lastPage>1&&!te.value?(l(),o("div",Y,[n(D,{page:d(O).pagination.page,"last-page":d(O).pagination.lastPage,onChange:a[3]||(a[3]=e=>ue(e))},null,8,["page","last-page"])])):g("",!0)])):g("",!0)]),_:1})],4)):g("",!0)]),_:1})],512),d(Q).sections.projectlist.open?g("",!0):(l(),o("div",$,[i("span",G,"You have total of "+x(d(O).pagination.total)+" projects - ",1),i("span",{class:y(se.value?"text-green-500":"text-gray-500")},x(se.value?"Sort mode":"Page mode"),3)])),se.value?(l(),o("div",J,[a[7]||(a[7]=b(" Drag to reorder projects Â· Changes are saved automatically. ",-1)),i("button",{onClick:j(ve,["stop"]),class:"text-red-500 underline"}," Disable! ")])):g("",!0)])],64))}};export{K as default};
